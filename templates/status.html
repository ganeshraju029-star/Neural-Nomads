<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - Military Secure Messaging</title>
    <style>
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            border: 1px solid var(--accent-color);
            padding: 20px;
            background: rgba(26, 26, 26, 0.9);
        }
        
        .status-card h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 65, 0.2);
        }
        
        .status-value {
            font-weight: bold;
        }
        
        .status-active { color: var(--accent-color); }
        .status-warning { color: var(--warning-color); }
        .status-danger { color: var(--danger-color); }
        
        .emergency-section {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid var(--danger-color);
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
        
        .threat-level {
            font-size: 1.5em;
            font-weight: bold;
            text-transform: uppercase;
            padding: 10px 20px;
            border: 2px solid;
            display: inline-block;
            margin: 10px;
        }
        
        .threat-low { 
            color: var(--accent-color); 
            border-color: var(--accent-color);
            background: rgba(0, 255, 65, 0.1);
        }
        .threat-medium { 
            color: var(--warning-color); 
            border-color: var(--warning-color);
            background: rgba(255, 170, 0, 0.1);
        }
        .threat-high { 
            color: var(--danger-color); 
            border-color: var(--danger-color);
            background: rgba(255, 0, 0, 0.1);
        }
        
        .metrics-chart {
            height: 200px;
            border: 1px solid var(--accent-color);
            background: black;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 System Status Dashboard</h1>
            <p>Real-time security monitoring</p>
        </div>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="status-grid">
            <!-- Tor Status -->
            <div class="status-card">
                <h3>🧅 Tor Network Status</h3>
                {% if status.tor_status.active %}
                    <div class="status-item">
                        <span>Status:</span>
                        <span class="status-value status-active">CONNECTED</span>
                        {% if status.tor_status.development_mode %}
                            <small style="color: #ffaa00; display: block; font-size: 0.7em;">Development Mode</small>
                        {% endif %}
                    </div>
                    <div class="status-item">
                        <span>Hidden Service:</span>
                        <span class="status-value status-active">ACTIVE</span>
                    </div>
                    <div class="status-item">
                        <span>Onion Address:</span>
                        <span class="status-value" style="font-size: 0.8em;">{{ status.tor_status.onion_url or 'Generating...' }}</span>
                    </div>
                    <div class="status-item">
                        <span>Exit IP:</span>
                        <span class="status-value">{{ status.tor_status.current_ip or 'Unknown' }}</span>
                    </div>
                    {% if status.tor_status.status_message %}
                        <div class="status-item" style="border-top: 1px solid #333; margin-top: 10px; padding-top: 10px;">
                            <small style="color: #888;">{{ status.tor_status.status_message }}</small>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="status-item">
                        <span>Status:</span>
                        <span class="status-value status-danger">DISCONNECTED</span>
                    </div>
                    <div class="status-item">
                        <span>Info:</span>
                        <span style="color: #888; font-size: 0.8em;">Running in fallback mode</span>
                    </div>
                {% endif %}
            </div>
            
            <!-- AI IDS Status -->
            <div class="status-card">
                <h3>🤖 AI Intrusion Detection</h3>
                <div class="status-item">
                    <span>Threat Level:</span>
                    <span class="threat-level threat-{{ status.ids_status.threat_level }}">{{ status.ids_status.threat_level }}</span>
                </div>
                <div class="status-item">
                    <span>Active Sessions:</span>
                    <span class="status-value">{{ status.ids_status.active_sessions }}</span>
                </div>
                <div class="status-item">
                    <span>Blocked IPs:</span>
                    <span class="status-value status-warning">{{ status.ids_status.blocked_ips }}</span>
                </div>
                <div class="status-item">
                    <span>Recent Events:</span>
                    <span class="status-value">{{ status.ids_status.recent_events }}</span>
                </div>
            </div>
            
            <!-- Memory Status -->
            <div class="status-card">
                <h3>💾 Secure Memory</h3>
                <div class="status-item">
                    <span>Active Messages:</span>
                    <span class="status-value status-active">{{ status.memory_usage }}</span>
                </div>
                <div class="status-item">
                    <span>Memory Protection:</span>
                    <span class="status-value status-active">ENABLED</span>
                </div>
                <div class="status-item">
                    <span>Auto-Wipe:</span>
                    <span class="status-value status-active">ACTIVE</span>
                </div>
                <div class="status-item">
                    <span>Forensics Resistance:</span>
                    <span class="status-value status-active">MAXIMUM</span>
                </div>
            </div>
            
            <!-- Security Signals -->
            <div class="status-card">
                <h3>📡 Security Monitoring</h3>
                <div class="status-item">
                    <span>Signal Events:</span>
                    <span class="status-value">{{ status.security_signals.event_statistics.total_events or 0 }}</span>
                </div>
                <div class="status-item">
                    <span>Recent Activity:</span>
                    <span class="status-value">{{ status.security_signals.recent_actions or 0 }}</span>
                </div>
                <div class="status-item">
                    <span>Active Threats:</span>
                    <span class="status-value status-warning">{{ status.security_signals.active_threats or 0 }}</span>
                </div>
                <div class="status-item">
                    <span>Monitoring:</span>
                    <span class="status-value status-active">CONTINUOUS</span>
                </div>
            </div>
            
            <!-- Session Info -->
            <div class="status-card">
                <h3>👤 Session Information</h3>
                <div class="status-item">
                    <span>User ID:</span>
                    <span class="status-value">{{ status.session_info.user_id or 'Anonymous' }}</span>
                </div>
                <div class="status-item">
                    <span>Session ID:</span>
                    <span class="status-value" style="font-size: 0.8em;">{{ status.session_info.session_id or 'None' }}</span>
                </div>
                <div class="status-item">
                    <span>Authentication:</span>
                    <span class="status-value status-active">VERIFIED</span>
                </div>
                <div class="status-item">
                    <span>Encryption:</span>
                    <span class="status-value status-active">END-TO-END</span>
                </div>
            </div>
            
            <!-- System Metrics -->
            <div class="status-card">
                <h3>⚡ System Metrics</h3>
                <div class="status-item">
                    <span>CPU Usage:</span>
                    <span class="status-value">{{ status.ids_status.system_metrics.metrics.cpu_usage or 0 }}%</span>
                </div>
                <div class="status-item">
                    <span>Memory Usage:</span>
                    <span class="status-value">{{ status.ids_status.system_metrics.metrics.memory_usage or 0 }}%</span>
                </div>
                <div class="status-item">
                    <span>Network Connections:</span>
                    <span class="status-value">{{ status.ids_status.system_metrics.metrics.network_connections or 0 }}</span>
                </div>
                <div class="status-item">
                    <span>Security Level:</span>
                    <span class="status-value status-active">MAXIMUM</span>
                </div>
            </div>
        </div>
        
        <div class="emergency-section">
            <h3>🚨 Emergency Controls</h3>
            <p>Use these controls only in case of security breach or emergency</p>
            
            <form method="POST" action="/emergency_wipe" style="display: inline-block; margin: 10px;">
                <button type="submit" class="btn btn-danger" 
                        onclick="return confirm('This will permanently destroy all messages and session data. Continue?')">
                    🗑️ Emergency Memory Wipe
                </button>
            </form>
            
            <button class="btn btn-danger" onclick="rotateCircuit()">
                🔄 Rotate Tor Circuit
            </button>
        </div>
        
        <div class="action-buttons">
            <a href="/" class="btn">🏠 Back to Home</a>
            <a href="/send_message" class="btn">📝 Send Message</a>
            <button class="btn" onclick="location.reload()">🔄 Refresh Status</button>
        </div>
    </div>
    
    <script>
        // Auto-refresh status every 30 seconds
        setInterval(() => {
            location.reload();
        }, 30000);
        
        // Rotate Tor circuit
        function rotateCircuit() {
            if (confirm('Rotate Tor circuit for enhanced anonymity?')) {
                fetch('/api/rotate_circuit', {method: 'POST'})
                    .then(() => {
                        alert('Tor circuit rotated successfully');
                        location.reload();
                    })
                    .catch(() => {
                        alert('Failed to rotate circuit');
                    });
            }
        }
        
        // Threat level animation
        const threatLevel = document.querySelector('.threat-level');
        if (threatLevel) {
            const level = threatLevel.textContent.toLowerCase();
            if (level === 'high' || level === 'critical') {
                threatLevel.style.animation = 'pulse 1s infinite';
            }
        }
        
        // Real-time status updates
        function updateMetrics() {
            const metrics = document.querySelectorAll('.status-value');
            metrics.forEach(metric => {
                if (Math.random() > 0.9) {
                    metric.style.textShadow = '0 0 10px currentColor';
                    setTimeout(() => {
                        metric.style.textShadow = 'none';
                    }, 500);
                }
            });
        }
        
        setInterval(updateMetrics, 2000);
    </script>
</body>
</html>